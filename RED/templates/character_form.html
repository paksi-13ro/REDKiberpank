<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Лист персонажа Cyberpunk RED</title>
    <style>
        /* Точные стили для соответствия скриншоту */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Times New Roman', serif;
            background-color: #f5f5f5;
            color: #000;
            padding: 20px;
            line-height: 1.4;
        }
        
        .character-sheet {
            width: 210mm;
            min-height: 297mm;
            background: white;
            margin: 0 auto;
            padding: 15mm;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            font-size: 11pt;
        }
        
        /* Стили для таблиц как на скриншоте */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            font-size: 10pt;
        }
        
        th, td {
            border: 1px solid #000;
            padding: 4px 6px;
            vertical-align: top;
            text-align: left;
        }
        
        th {
            background-color: #e0e0e0;
            font-weight: bold;
        }
        
        .section-title {
            font-size: 14pt;
            font-weight: bold;
            margin: 20px 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 2px solid #000;
            text-transform: uppercase;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin: 15px 0;
        }
        
        .stat-box {
            border: 1px solid #000;
            padding: 10px;
            text-align: center;
        }
        
        .stat-label {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 10pt;
        }
        
        .stat-input {
            width: 100%;
            border: none;
            border-bottom: 1px solid #000;
            text-align: center;
            font-size: 14pt;
            font-weight: bold;
            background: transparent;
            outline: none;
        }
        
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 15px 0;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-label {
            display: block;
            font-weight: bold;
            margin-bottom: 4px;
            font-size: 10pt;
        }
        
        .form-input {
            width: 100%;
            padding: 6px;
            border: 1px solid #000;
            font-family: inherit;
            font-size: 10pt;
            background: transparent;
        }
        
        .form-input:focus {
            outline: 2px solid #0066cc;
        }
        
        textarea.form-input {
            min-height: 80px;
            resize: vertical;
        }
        
        .health-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 2px;
            margin: 10px 0;
        }
        
        .health-box {
            width: 24px;
            height: 24px;
            border: 1px solid #000;
            display: inline-block;
            cursor: pointer;
        }
        
        .health-box.filled {
            background-color: #000;
        }
        
        .weapons-armor {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 15px 0;
        }
        
        .cyberware-table {
            margin: 15px 0;
        }
        
        .cyberware-table table {
            margin-bottom: 0;
        }
        
        .cyberware-table td {
            height: 40px;
        }
        
        .controls {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #000;
            text-align: center;
        }
        
        .btn {
            padding: 10px 25px;
            margin: 0 10px;
            background: #0066cc;
            color: white;
            border: none;
            cursor: pointer;
            font-family: inherit;
            font-size: 11pt;
            font-weight: bold;
        }
        
        .btn:hover {
            background: #0055aa;
        }
        
        .btn-save {
            background: #008000;
        }
        
        .btn-save:hover {
            background: #006600;
        }
        
        .btn-delete {
            background: #cc0000;
        }
        
        .btn-delete:hover {
            background: #aa0000;
        }
        
        /* Специфичные стили для точного соответствия */
        .main-header {
            text-align: center;
            font-size: 16pt;
            font-weight: bold;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .skill-table th {
            width: 25%;
        }
        
        .checkbox-cell {
            width: 20px;
            text-align: center;
        }
        
        .notes {
            margin-top: 20px;
            font-style: italic;
            font-size: 9pt;
            color: #666;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .character-sheet {
                box-shadow: none;
                padding: 0;
                margin: 0;
                width: 100%;
            }
            
            .controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <form id="characterForm">
        <div class="character-sheet">
            <input type="hidden" id="characterId" name="id" value="{{ character.id if character else '' }}">
            
            <!-- Заголовок -->
            <div class="main-header">Итог</div>
            
            <!-- Основная информация -->
            <table>
                <tr>
                    <th width="15%">Имя</th>
                    <td width="35%"><input type="text" name="name" class="form-input" value="{{ character.name if character else '' }}" required></td>
                    <th width="15%">Роль</th>
                    <td width="35%"><input type="text" name="role" class="form-input" value="{{ character.role if character else '' }}"></td>
                </tr>
                <tr>
                    <th>Осевая способность</th>
                    <td><input type="text" name="ability" class="form-input" value="{{ character.ability if character else '' }}"></td>
                    <th>Культурное наследие</th>
                    <td><input type="text" name="heritage" class="form-input" value="{{ character.heritage if character else '' }}"></td>
                </tr>
            </table>
            
            <!-- Статистики -->
            <div class="section-title">Характеристики</div>
            <div class="stats-grid">
                {% set stats = [
                    ('ИНТ', 'int'), ('РЕА', 'rea'), ('ЛВК', 'luck'), ('ТЕХ', 'tech'), ('ХАР', 'char'),
                    ('ВОЛЯ', 'will'), ('УДЧ', 'udch'), ('СКО', 'sko'), ('ТЕЛ', 'tel'), ('ЭМП', 'emp')
                ] %}
                {% for label, key in stats %}
                <div class="stat-box">
                    <div class="stat-label">{{ label }}</div>
                    <input type="number" name="stats_{{ key }}" class="stat-input" min="0" max="10" 
                           value="{{ character['stats_' + key] if character and 'stats_' + key in character else 0 }}">
                </div>
                {% endfor %}
            </div>
            
            <!-- Навыки -->
            <div class="section-title">Навыки</div>
            <table class="skill-table">
                <tr>
                    <th>Навык</th>
                    <th>Характеристика</th>
                    <th>Уровень</th>
                    <th>STAT</th>
                    <th>Бонус</th>
                </tr>
                {% set skills = [
                    ('Концентрация (ВОЛЯ)', 'concentration', 'will'),
                    ('Внимательность (РЕА)', 'perception', 'rea'),
                    ('Убеждение (ХАР)', 'persuasion', 'char'),
                    ('Скрытность (СКО)', 'stealth', 'sko'),
                    ('Выживание (ВОЛЯ)', 'survival', 'will'),
                    ('Ближний бой (ТЕЛ)', 'melee', 'tel'),
                    ('Дальний бой (ТЕЛ)', 'ranged', 'tel'),
                    ('Управление ТС (РЕА)', 'driving', 'rea'),
                    ('Образование (ИНТ)', 'education', 'int'),
                    ('Знание улиц (ИНТ)', 'streetwise', 'int'),
                    ('Социальное (ХАР)', 'social', 'char')
                ] %}
                {% for label, key, stat in skills %}
                <tr>
                    <td>{{ label }}</td>
                    <td>{{ stat }}</td>
                    <td><input type="number" name="skill_{{ key }}" class="form-input" style="width: 60px;" 
                               value="{{ character['skill_' + key] if character and 'skill_' + key in character else 0 }}"></td>
                    <td><input type="text" name="skill_{{ key }}_stat" class="form-input" style="width: 40px;"></td>
                    <td><input type="text" name="skill_{{ key }}_bonus" class="form-input" style="width: 40px;"></td>
                </tr>
                {% endfor %}
            </table>
            
            <!-- Жизненный путь -->
            <div class="section-title">Жизненный путь</div>
            <div class="two-column">
                <div>
                    <div class="form-group">
                        <label class="form-label">Культурное наследие</label>
                        <input type="text" name="cultural_heritage" class="form-input" 
                               value="{{ character.cultural_heritage if character else '' }}">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Стиль одежды</label>
                        <input type="text" name="clothing_style" class="form-input" 
                               value="{{ character.clothing_style if character else '' }}">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Что ты ценишь больше всего?</label>
                        <input type="text" name="values" class="form-input" 
                               value="{{ character.values if character else '' }}">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Самый близкий человек</label>
                        <input type="text" name="closest_person" class="form-input" 
                               value="{{ character.closest_person if character else '' }}">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">История семьи</label>
                        <textarea name="family_history" class="form-input">{{ character.family_history if character else '' }}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Семейное положение</label>
                        <input type="text" name="family_status" class="form-input" 
                               value="{{ character.family_status if character else '' }}">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Друзья</label>
                        <textarea name="friends" class="form-input">{{ character.friends if character else '' }}</textarea>
                    </div>
                </div>
                
                <div>
                    <div class="form-group">
                        <label class="form-label">Личность</label>
                        <input type="text" name="personality" class="form-input" 
                               value="{{ character.personality if character else '' }}">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Прическа</label>
                        <input type="text" name="hairstyle" class="form-input" 
                               value="{{ character.hairstyle if character else '' }}">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Отношение к людям?</label>
                        <input type="text" name="attitude" class="form-input" 
                               value="{{ character.attitude if character else '' }}">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Самое ценное, чем ты обладаешь</label>
                        <input type="text" name="most_valuable" class="form-input" 
                               value="{{ character.most_valuable if character else '' }}">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Среда, в которой прошло детство</label>
                        <textarea name="childhood" class="form-input">{{ character.childhood if character else '' }}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Жизненные цели</label>
                        <textarea name="goals" class="form-input">{{ character.goals if character else '' }}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Трагическая любовь</label>
                        <textarea name="tragic_love" class="form-input">{{ character.tragic_love if character else '' }}</textarea>
                    </div>
                </div>
            </div>
            
            <!-- Враги -->
            <div class="form-group">
                <label class="form-label">Враги:</label>
                <textarea name="enemies" class="form-input" rows="3">{{ character.enemies if character else '' }}</textarea>
            </div>
            
            <!-- Оружие и броня -->
            <div class="section-title">Оружие и броня</div>
            <div class="weapons-armor">
                <div>
                    <div class="form-group">
                        <label class="form-label">Оружие</label>
                        <textarea name="weapon" class="form-input" rows="4">{{ character.weapon if character else '' }}</textarea>
                    </div>
                </div>
                
                <div>
                    <table>
                        <tr>
                            <th>Броня</th>
                            <th>SP</th>
                            <th>Штука</th>
                        </tr>
                        <tr>
                            <td>Защита головы</td>
                            <td><input type="text" name="armor_head_sp" class="form-input" style="width: 50px;" 
                                       value="{{ character.armor_head_sp if character else '' }}"></td>
                            <td><input type="text" name="armor_head_desc" class="form-input"></td>
                        </tr>
                        <tr>
                            <td>Защита туловища</td>
                            <td><input type="text" name="armor_body_sp" class="form-input" style="width: 50px;" 
                                       value="{{ character.armor_body_sp if character else '' }}"></td>
                            <td><input type="text" name="armor_body_desc" class="form-input"></td>
                        </tr>
                        <tr>
                            <td>Ноги</td>
                            <td><input type="text" name="armor_legs_sp" class="form-input" style="width: 50px;"></td>
                            <td><input type="text" name="armor_legs_desc" class="form-input"></td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <!-- Киберимпланты -->
            <div class="section-title">Киберимпланты</div>
            <div class="cyberware-table">
                <table>
                    <tr>
                        <th width="30%">Право/лево кибер...</th>
                        <th>Информация</th>
                    </tr>
                    {% for i in range(8) %}
                    <tr>
                        <td><input type="text" name="cyberware_name_{{ i+1 }}" class="form-input" 
                                   value="{{ character['cyberware_name_' + (i+1)|string] if character and 'cyberware_name_' + (i+1)|string in character else '' }}"></td>
                        <td><input type="text" name="cyberware_info_{{ i+1 }}" class="form-input" 
                                   value="{{ character['cyberware_info_' + (i+1)|string] if character and 'cyberware_info_' + (i+1)|string in character else '' }}"></td>
                    </tr>
                    {% endfor %}
                </table>
                <p class="notes">Для базовых киберимплантов (например, киберглаз) поставьте галочку, чтобы обозначить, что он у вас имеется. Дополнительные опции размещаются в слотах ниже.</p>
                <p class="notes">Для расширенных киберимплантов (например, для внутреннего киберимпланта) просто пометьте каждую часть в слотах под названием категории.</p>
            </div>
            
            <!-- Управление -->
            <div class="controls">
                <button type="button" onclick="saveCharacter()" class="btn btn-save">СОХРАНИТЬ</button>
                <button type="button" onclick="window.location.href='/'" class="btn">ГЛАВНАЯ</button>
                {% if character %}
                <button type="button" onclick="generatePDF({{ character.id }})" class="btn">СКАЧАТЬ PDF</button>
                <button type="button" onclick="deleteCharacter({{ character.id }})" class="btn btn-delete">УДАЛИТЬ</button>
                {% endif %}
            </div>
        </div>
    </form>
    
    <script>
        // Сохранение персонажа
        async function saveCharacter() {
            const form = document.getElementById('characterForm');
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            try {
                const response = await fetch('/api/character', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Персонаж сохранен!');
                    if (!data.id) {
                        window.location.href = `/character?id=${result.id}`;
                    }
                } else {
                    alert('Ошибка сохранения: ' + result.error);
                }
            } catch (error) {
                alert('Ошибка сети: ' + error);
            }
        }
        
        // Генерация PDF
        function generatePDF(characterId) {
            window.open(`/character/${characterId}/pdf`, '_blank');
        }
        
        // Удаление персонажа
        async function deleteCharacter(characterId) {
            if (confirm('Удалить этого персонажа?')) {
                try {
                    const response = await fetch(`/api/delete/character/${characterId}`, {
                        method: 'DELETE'
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        alert('Персонаж удален');
                        window.location.href = '/characters';
                    } else {
                        alert('Ошибка удаления: ' + result.error);
                    }
                } catch (error) {
                    alert('Ошибка сети: ' + error);
                }
            }
        }
    </script>
</body>
</html>