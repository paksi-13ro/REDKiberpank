<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ТАЧКА - ТРАНСПОРТ ИГРОКА</title>
    <style>
        /* ТОЧНЫЕ СТИЛИ ИЗ PDF ФАЙЛА */
        @page {
            size: A4;
            margin: 0;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            font-size: 10pt;
            line-height: 1.1;
            color: #000000;
            margin: 0;
            padding: 15mm;
            background: #ffffff;
            width: 210mm;
            min-height: 297mm;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        .vehicle-sheet {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        /* Заголовки */
        .main-title {
            text-align: center;
            font-size: 16pt;
            font-weight: bold;
            margin-bottom: 5mm;
            text-transform: uppercase;
        }
        
        .subtitle {
            text-align: center;
            font-size: 14pt;
            font-weight: bold;
            margin-bottom: 8mm;
            text-transform: uppercase;
        }
        
        /* Информация о транспорте */
        .vehicle-info {
            margin-bottom: 8mm;
        }
        
        .info-label {
            font-weight: bold;
            margin-bottom: 2mm;
            display: block;
        }
        
        .info-input {
            width: 100%;
            border: 1px solid #000;
            background: transparent;
            padding: 2mm;
            font-family: inherit;
            font-size: inherit;
            box-sizing: border-box;
        }
        
        .info-input:focus {
            outline: 2px solid #0066cc;
        }
        
        /* Основная таблица характеристик */
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10mm;
            font-size: 9pt;
        }
        
        .stats-table th,
        .stats-table td {
            border: 1px solid #000;
            padding: 1mm 2mm;
            text-align: center;
            vertical-align: middle;
        }
        
        .stats-table th {
            background-color: #e0e0e0;
            font-weight: bold;
        }
        
        .category-cell {
            text-align: left;
            font-weight: bold;
            width: 15%;
        }
        
        .value-cell {
            width: 20%;
        }
        
        .form-input {
            width: 100%;
            border: none;
            background: transparent;
            font-family: inherit;
            font-size: inherit;
            text-align: center;
        }
        
        .form-input:focus {
            outline: 1px solid #0066cc;
        }
        
        /* Таблица оружия */
        .weapons-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10mm;
            font-size: 9pt;
        }
        
        .weapons-table th,
        .weapons-table td {
            border: 1px solid #000;
            padding: 1mm 2mm;
            text-align: center;
            vertical-align: middle;
        }
        
        .weapons-table th {
            background-color: #e0e0e0;
            font-weight: bold;
        }
        
        /* Таблица повреждений */
        .damage-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 9pt;
        }
        
        .damage-table th,
        .damage-table td {
            border: 1px solid #000;
            padding: 1mm 2mm;
            text-align: center;
            vertical-align: middle;
            width: 10%;
        }
        
        .damage-table th {
            background-color: #e0e0e0;
            font-weight: bold;
        }
        
        .damage-box {
            width: 8mm;
            height: 8mm;
            border: 1px solid #000;
            display: inline-block;
            cursor: pointer;
            margin: 1mm;
        }
        
        .damage-box.filled {
            background-color: #000;
        }
        
        /* Управление */
        .controls {
            margin-top: 15mm;
            text-align: center;
        }
        
        .btn {
            padding: 3mm 8mm;
            margin: 0 5mm;
            background: #0066cc;
            color: white;
            border: none;
            cursor: pointer;
            font-family: inherit;
            font-size: 11pt;
            font-weight: bold;
            border-radius: 1mm;
        }
        
        .btn:hover {
            background: #0055aa;
        }
        
        .btn-save {
            background: #008000;
        }
        
        .btn-save:hover {
            background: #006600;
        }
        
        .btn-delete {
            background: #cc0000;
        }
        
        .btn-delete:hover {
            background: #aa0000;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .vehicle-sheet {
                padding: 0;
                margin: 0;
                width: 100%;
            }
            
            .controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <form id="vehicleForm">
        <div class="vehicle-sheet">
            <input type="hidden" id="vehicleId" name="id" value="{{ vehicle.id if vehicle else '' }}">
            
            <!-- Заголовок -->
            <div class="main-title">ТАЧКА</div>
            <div class="subtitle">ТРАНСПОРТ ИГРОКА</div>
            
            <!-- Основная информация -->
            <div class="vehicle-info">
                <label class="info-label">НАЗВАНИЕ ТРАНСПОРТА</label>
                <input type="text" name="name" class="info-input" value="{{ vehicle.name if vehicle else '' }}" required>
            </div>
            
            <div class="vehicle-info">
                <label class="info-label">ТИП ТРАНСПОРТА</label>
                <input type="text" name="type" class="info-input" value="{{ vehicle.type if vehicle else '' }}">
            </div>
            
            <!-- Характеристики -->
            <table class="stats-table">
                <tr>
                    <th colspan="5">ХАРАКТЕРИСТИКИ</th>
                </tr>
                <tr>
                    <td class="category-cell">МАНЁВРЕННОСТЬ</td>
                    <td class="value-cell"><input type="number" name="maneuverability" class="form-input" value="{{ vehicle.maneuverability if vehicle else '' }}"></td>
                    <td class="category-cell">ЗАЩИТА</td>
                    <td class="value-cell"><input type="number" name="armor" class="form-input" value="{{ vehicle.armor if vehicle else '' }}"></td>
                    <td rowspan="3">
                        <div>ЭКИПАЖ</div>
                        <input type="number" name="crew" class="form-input" value="{{ vehicle.crew if vehicle else '' }}" style="height: 20mm;">
                    </td>
                </tr>
                <tr>
                    <td class="category-cell">МАКС. СКОРОСТЬ</td>
                    <td class="value-cell"><input type="number" name="max_speed" class="form-input" value="{{ vehicle.max_speed if vehicle else '' }}"></td>
                    <td class="category-cell">СПИДОМЕТР</td>
                    <td class="value-cell"><input type="number" name="speedometer" class="form-input" value="{{ vehicle.speedometer if vehicle else '' }}"></td>
                </tr>
                <tr>
                    <td class="category-cell">УСТОЙЧИВОСТЬ</td>
                    <td class="value-cell"><input type="number" name="stability" class="form-input" value="{{ vehicle.stability if vehicle else '' }}"></td>
                    <td class="category-cell">ЗАПАС ХОДА</td>
                    <td class="value-cell"><input type="number" name="range" class="form-input" value="{{ vehicle.range if vehicle else '' }}"></td>
                </tr>
            </table>
            
            <!-- Оружие -->
            <table class="weapons-table">
                <tr>
                    <th colspan="6">ОРУЖИЕ</th>
                </tr>
                <tr>
                    <th>НАЗВАНИЕ</th>
                    <th>ТИП</th>
                    <th>ОЧКИ АТАКИ</th>
                    <th>ДАЛЬН. СТРЕЛЬБА</th>
                    <th>УРОН</th>
                    <th>КОММЕНТАРИИ</th>
                </tr>
                {% for i in range(8) %}
                <tr>
                    <td><input type="text" name="weapon_{{ i+1 }}_name" class="form-input" value="{{ vehicle['weapon_' + (i+1)|string + '_name'] if vehicle and 'weapon_' + (i+1)|string + '_name' in vehicle else '' }}"></td>
                    <td><input type="text" name="weapon_{{ i+1 }}_type" class="form-input" value="{{ vehicle['weapon_' + (i+1)|string + '_type'] if vehicle and 'weapon_' + (i+1)|string + '_type' in vehicle else '' }}"></td>
                    <td><input type="text" name="weapon_{{ i+1 }}_attack_points" class="form-input" value="{{ vehicle['weapon_' + (i+1)|string + '_attack_points'] if vehicle and 'weapon_' + (i+1)|string + '_attack_points' in vehicle else '' }}"></td>
                    <td><input type="text" name="weapon_{{ i+1 }}_range" class="form-input" value="{{ vehicle['weapon_' + (i+1)|string + '_range'] if vehicle and 'weapon_' + (i+1)|string + '_range' in vehicle else '' }}"></td>
                    <td><input type="text" name="weapon_{{ i+1 }}_damage" class="form-input" value="{{ vehicle['weapon_' + (i+1)|string + '_damage'] if vehicle and 'weapon_' + (i+1)|string + '_damage' in vehicle else '' }}"></td>
                    <td><input type="text" name="weapon_{{ i+1 }}_comments" class="form-input" value="{{ vehicle['weapon_' + (i+1)|string + '_comments'] if vehicle and 'weapon_' + (i+1)|string + '_comments' in vehicle else '' }}"></td>
                </tr>
                {% endfor %}
            </table>
            
            <!-- Повреждения -->
            <table class="damage-table">
                <tr>
                    <th colspan="10">ПОВРЕЖДЕНИЯ</th>
                </tr>
                <tr>
                    <th>1</th>
                    <th>2</th>
                    <th>3</th>
                    <th>4</th>
                    <th>5</th>
                    <th>6</th>
                    <th>7</th>
                    <th>8</th>
                    <th>9</th>
                    <th>10</th>
                </tr>
                <tr>
                    {% for i in range(10) %}
                    <td><div class="damage-box" onclick="toggleDamage(this)"></div></td>
                    {% endfor %}
                </tr>
            </table>
            
            <!-- Управление -->
            <div class="controls">
                <button type="button" onclick="saveVehicle()" class="btn btn-save">СОХРАНИТЬ</button>
                <button type="button" onclick="window.location.href='/'" class="btn">ГЛАВНАЯ</button>
                {% if vehicle %}
                <button type="button" onclick="generatePDF({{ vehicle.id }})" class="btn">СКАЧАТЬ PDF</button>
                <button type="button" onclick="deleteVehicle({{ vehicle.id }})" class="btn btn-delete">УДАЛИТЬ</button>
                {% endif %}
            </div>
        </div>
    </form>
    
    <script>
        // Переключение состояния повреждений
        function toggleDamage(element) {
            element.classList.toggle('filled');
        }
        
        // Сохранение транспорта
        async function saveVehicle() {
            const form = document.getElementById('vehicleForm');
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            try {
                const response = await fetch('/api/vehicle', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Транспорт сохранен!');
                    if (!data.id) {
                        window.location.href = `/vehicle?id=${result.id}`;
                    }
                } else {
                    alert('Ошибка сохранения: ' + result.error);
                }
            } catch (error) {
                alert('Ошибка сети: ' + error);
            }
        }
        
        // Генерация PDF
        function generatePDF(vehicleId) {
            window.open(`/vehicle/${vehicleId}/pdf`, '_blank');
        }
        
        // Удаление транспорта
        async function deleteVehicle(vehicleId) {
            if (confirm('Удалить этот транспорт?')) {
                try {
                    const response = await fetch(`/api/delete/vehicle/${vehicleId}`, {
                        method: 'DELETE'
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        alert('Транспорт удален');
                        window.location.href = '/';
                    } else {
                        alert('Ошибка удаления: ' + result.error);
                    }
                } catch (error) {
                    alert('Ошибка сети: ' + error);
                }
            }
        }
    </script>
</body>
</html>